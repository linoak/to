<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FFF9E6">
    <link rel="apple-touch-icon" href="icon.png">

    <title>Cozy Pomodoro | æº«é¦¨ç•ªèŒ„é˜</title>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #FFF9E6;
            --card-bg: #FFFFFF;
            --primary: #FFB7B2;
            --secondary: #B5EAD7;
            --text-color: #6D6060;
            --shadow: 0 8px 24px rgba(149, 157, 165, 0.2);
            --overlay-bg: rgba(109, 96, 96, 0.5);
            /* å½ˆçª—èƒŒæ™¯é®ç½© */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Varela Round', sans-serif;
            user-select: none;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: var(--card-bg);
            padding: 2.5rem;
            border-radius: 30px;
            box-shadow: var(--shadow);
            text-align: center;
            width: 90%;
            max-width: 400px;
            position: relative;
            border: 4px solid #FFF0F0;
        }

        /* --- é ‚éƒ¨æ§åˆ¶æŒ‰éˆ• (å·¦é‚Šèªªæ˜ï¼Œå³é‚ŠéŸ³æ¨‚) --- */
        .top-left-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
        }

        .top-right-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .control-btn {
            background: rgba(255, 240, 240, 0.5);
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 8px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #ccc;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #fff;
            color: var(--primary);
        }

        .control-btn.active {
            background: #fff;
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        h1 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-color);
            margin-top: 1rem;
        }

        .icon-placeholder {
            width: 120px;
            height: 120px;
            background-color: #FFF0F0;
            border-radius: 50%;
            margin: 0 auto 1.5rem auto;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            border: 3px dashed var(--primary);
            transition: transform 0.3s ease;
        }

        .timer-display {
            font-size: 4rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 1.5rem;
            text-shadow: 2px 2px 0px #ffeebb;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 2rem;
        }

        button.btn {
            border: none;
            padding: 12px 24px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.05);
        }

        button.btn:active {
            transform: scale(0.9);
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.05);
        }

        .btn-start {
            background-color: var(--secondary);
            color: #4b7a6a;
        }

        .btn-pause {
            background-color: #FFDAC1;
            color: #8a5a44;
        }

        .btn-reset {
            background-color: #E2F0CB;
            color: #5c7046;
        }

        #install-btn {
            display: none;
            background-color: #C7CEEA;
            color: #586084;
            margin-top: 15px;
            width: 100%;
            border-radius: 15px;
            padding: 10px;
        }

        .settings {
            border-top: 2px dashed #eee;
            padding-top: 1.5rem;
        }

        .input-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        input[type="number"] {
            width: 60px;
            padding: 8px;
            border: 2px solid #E2F0CB;
            border-radius: 15px;
            text-align: center;
            font-size: 1rem;
            color: var(--text-color);
            outline: none;
        }

        /* --- å½ˆè·³è¦–çª— (Modal) æ¨£å¼ --- */
        .modal-overlay {
            display: none;
            /* é è¨­éš±è— */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--overlay-bg);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px);
            /* èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ */
        }

        .modal-content {
            background: #fff;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            /* é™åˆ¶é«˜åº¦ï¼Œå¤ªé•·æœƒå‡ºæ²è»¸ */
            overflow-y: auto;
            /* å…§å®¹å¤ªé•·å¯æ²å‹• */
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            text-align: left;
            position: relative;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-content h2 {
            color: var(--primary);
            margin-bottom: 1rem;
            text-align: center;
        }

        .modal-content h3 {
            color: #586084;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .modal-content p {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #666;
            margin-bottom: 1rem;
        }

        .modal-content ul {
            padding-left: 1.2rem;
            margin-bottom: 1rem;
        }

        .modal-content li {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #666;
            margin-bottom: 0.3rem;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #999;
            cursor: pointer;
        }

        .close-btn:hover {
            color: var(--primary);
        }

        /* ç¾åŒ–æ²è»¸ */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background-color: #eee;
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background-color: var(--primary);
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="top-left-controls">
            <button class="control-btn active" onclick="openModal()" title="èªªæ˜">
                â“
            </button>
        </div>

        <div class="top-right-controls">
            <button class="control-btn" id="music-btn" onclick="toggleMusic()" title="èƒŒæ™¯éŸ³æ¨‚">ğŸµ</button>
            <button class="control-btn active" id="sound-btn" onclick="toggleSound()" title="æç¤ºéŸ³æ•ˆ">ğŸ”Š</button>
        </div>

        <h1>ğŸ… ç•ªèŒ„é˜å·¥ä½œæ³•</h1>
        <div class="icon-placeholder" id="icon-area"><span>ğŸ…</span></div>
        <div class="timer-display" id="timer">25:00</div>

        <div class="controls">
            <button class="btn btn-start" onclick="startTimer()">é–‹å§‹</button>
            <button class="btn btn-pause" onclick="pauseTimer()">æš«åœ</button>
            <button class="btn btn-reset" onclick="resetTimer()">é‡ç½®</button>
        </div>

        <div class="settings">
            <div class="input-group">
                <label for="custom-time">æ™‚é–“ (åˆ†):</label>
                <input type="number" id="custom-time" value="25" min="1" max="90" onchange="updateCustomTime()">
            </div>
            <button id="install-btn" class="btn">â¬‡ï¸ å®‰è£åˆ°æ¡Œé¢</button>
        </div>
    </div>

    <div class="modal-overlay" id="info-modal" onclick="closeModal(event)">
        <div class="modal-content">
            <button class="close-btn" onclick="forceCloseModal()">Ã—</button>
            <h2>ä»€éº¼æ˜¯ç•ªèŒ„å·¥ä½œæ³•ï¼Ÿ</h2>
            <p>ç•ªèŒ„å·¥ä½œæ³•æ˜¯ä¸€ç¨®æ™‚é–“ç®¡ç†æ–¹æ³•ï¼Œå…¶æ ¸å¿ƒåœ¨æ–¼çŸ­æš«å°ˆæ³¨çš„å·¥ä½œæ™‚æ®µï¼ˆé€šå¸¸ç‚º 25 åˆ†é˜ï¼‰å¾Œæ¥çŸ­æš«çš„ä¼‘æ¯æ™‚é–“ã€‚æ¯å€‹ 25 åˆ†é˜çš„æ™‚é–“æ®µè¢«ç¨±ç‚ºä¸€å€‹ç•ªèŒ„é˜ã€‚</p>
            <p>ä½†ç¶“å…¸çš„ 25/5 æ¨¡å¼ä¸¦éç¡¬æ€§è¦å®šï¼Œè€Œæ˜¯ä¸€ç¨®æ¡†æ¶ã€‚çŸ­æ™‚é–“å°ˆæ³¨çš„å·¥ä½œæ™‚æ®µå°æ–¼å•Ÿå‹•è¤‡é›œä»»å‹™ã€å…‹æœæ‹–å»¶ç—‡ä»¥åŠé€éç·Šè¿«æ„Ÿæå‡å°ˆæ³¨åŠ›éå¸¸æœ‰æ•ˆã€‚</p>

            <h3>ğŸ•°ï¸ å¸¸ç”¨è¨ˆæ™‚å€é–“åƒè€ƒ</h3>
            <ul>
                <li><strong>25 åˆ†é˜ä»»å‹™</strong> + 5 åˆ†é˜ä¼‘æ¯ (ç¶“å…¸)</li>
                <li><strong>30 åˆ†é˜ä»»å‹™</strong> + 6 åˆ†é˜ä¼‘æ¯</li>
                <li><strong>50 åˆ†é˜ä»»å‹™</strong> + 10 åˆ†é˜ä¼‘æ¯</li>
                <li><strong>1.5 å°æ™‚ä»»å‹™</strong> + 15 åˆ†é˜ä¼‘æ¯</li>
                <li><strong>2 å°æ™‚ä»»å‹™</strong> + 20 åˆ†é˜ä¼‘æ¯</li>
            </ul>

            <h3>âœ¨ ç•ªèŒ„å·¥ä½œæ³•çš„å¥½è™•</h3>
            <p>ç•ªèŒ„å·¥ä½œæ³•å°‡ä¸€å¤©çš„æ™‚é–“åˆ†æˆè‹¥å¹²å€‹æ˜“æ–¼ç®¡ç†çš„å°ˆæ³¨å’Œä¼‘æ¯æ™‚æ®µï¼Œå¹«åŠ©ä½ åœ¨å·¥ä½œä¸­ä¿æŒå°ˆæ³¨å’Œé«˜æ•ˆã€‚</p>
            <ul>
                <li><strong>æå‡å°ˆæ³¨åŠ›ï¼š</strong>åœ¨ç·Šæ€¥ã€é™æ™‚çš„é›†ä¸­è¨»æ„åŠ›æ–¹é¢æœ‰æ‰€æå‡ã€‚</li>
                <li><strong>æå‡å‹•åŠ›ï¼š</strong>å°å°çš„æˆåŠŸèƒ½å¤ ç´¯ç©å‹•èƒ½å’Œé€²æ­¥ã€‚</li>
                <li><strong>æ¸›å°‘æ‹–å»¶ï¼š</strong>æ›´å®¹æ˜“é–‹å§‹ä»»å‹™ä¸¦å…‹æœæ±ºç­–ç™±ç˜“ã€‚</li>
                <li><strong>é˜²æ­¢å€¦æ€ ï¼š</strong>å®šæœŸä¼‘æ¯å¯ä»¥ä¿æŒç²¾åŠ›å……æ²›å’Œæ€ç¶­æ¸…æ™°ã€‚</li>
                <li><strong>å»ºç«‹ç¯€å¥ï¼š</strong>å‰µé€ å¯æŒçºŒçš„å°ˆæ³¨èˆ‡ä¼‘æ¯å¾ªç’°ã€‚</li>
                <li><strong>æ¸›å°‘å¹²æ“¾ï¼š</strong>å¹«åŠ©ä½ é›†ä¸­è¨»æ„åŠ›ï¼ŒæŠµç¦¦å¹¹æ“¾ã€‚</li>
                <li><strong>æ”¯æ´æ·±åº¦å·¥ä½œï¼š</strong>å¢å¼·å°ˆæ³¨åŠ›ï¼Œå»¶é•·å¿ƒæµç‹€æ…‹ã€‚</li>
            </ul>
        </div>
    </div>

    <audio id="bgm-player" loop>
        <source src="breakfast2.mp3" type="audio/mpeg">
    </audio>

    <script>
        // --- å½ˆè·³è¦–çª—é‚è¼¯ ---
        const modal = document.getElementById('info-modal');

        function openModal() {
            modal.style.display = 'flex';
        }

        // é»æ“ŠèƒŒæ™¯é—œé–‰
        function closeModal(e) {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        }

        // é»æ“Š X æŒ‰éˆ•é—œé–‰
        function forceCloseModal() {
            modal.style.display = 'none';
        }

        // --- PWA é‚è¼¯ ---
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault(); deferredPrompt = e; installBtn.style.display = 'block';
            installBtn.addEventListener('click', () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(() => { deferredPrompt = null; installBtn.style.display = 'none'; });
            });
        });

        // --- ç•ªèŒ„é˜èˆ‡éŸ³æ¨‚é‚è¼¯ ---
        let timeLeft = 25 * 60;
        let timerId = null;
        let isRunning = false;
        let isSoundOn = true;
        let isMusicPlaying = false;

        const timerDisplay = document.getElementById('timer');
        const customTimeInput = document.getElementById('custom-time');
        const iconArea = document.getElementById('icon-area');
        const soundBtn = document.getElementById('sound-btn');
        const musicBtn = document.getElementById('music-btn');
        const bgmPlayer = document.getElementById('bgm-player');
        bgmPlayer.volume = 0.4;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function toggleMusic() {
            if (isMusicPlaying) {
                bgmPlayer.pause();
                musicBtn.classList.remove('active');
                musicBtn.style.opacity = "0.5";
            } else {
                bgmPlayer.play().then(() => {
                    musicBtn.classList.add('active');
                    musicBtn.style.opacity = "1";
                }).catch(error => { alert("è«‹å…ˆèˆ‡é é¢äº’å‹•å¾Œå†é»æ“ŠéŸ³æ¨‚æŒ‰éˆ•ï¼"); });
            }
            isMusicPlaying = !isMusicPlaying;
        }

        function toggleSound() {
            isSoundOn = !isSoundOn;
            soundBtn.textContent = isSoundOn ? "ğŸ”Š" : "ğŸ”‡";
            soundBtn.classList.toggle("active");
            if (isSoundOn) playClickSound();
        }

        function playTone(freq, type, duration, volume = 0.1) {
            if (!isSoundOn) return;
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(volume, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playClickSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            if (!isSoundOn) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function playAlarmSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            playTone(523.25, 'sine', 1.5, 0.2);
            setTimeout(() => playTone(659.25, 'sine', 1.5, 0.2), 200);
            setTimeout(() => playTone(783.99, 'sine', 2.0, 0.2), 400);
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s < 10 ? '0' : ''}${s}`;
        }

        function updateDisplay() {
            timerDisplay.textContent = formatTime(timeLeft);
            document.title = `${formatTime(timeLeft)} - æº«é¦¨ç•ªèŒ„é˜`;
        }

        function startTimer() {
            if (isRunning) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            playClickSound();
            isRunning = true;
            iconArea.style.transform = "scale(1.1)";
            timerId = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateDisplay();
                } else {
                    clearInterval(timerId);
                    isRunning = false;
                    playAlarmSound();
                    iconArea.style.transform = "scale(1)";
                }
            }, 1000);
        }

        function pauseTimer() {
            playClickSound();
            clearInterval(timerId);
            isRunning = false;
            iconArea.style.transform = "scale(1)";
        }

        function resetTimer() {
            playClickSound();
            pauseTimer();
            timeLeft = parseInt(customTimeInput.value) * 60;
            updateDisplay();
        }

        function updateCustomTime() {
            if (!isRunning) {
                let minutes = parseInt(customTimeInput.value);
                if (minutes < 1) minutes = 1;
                timeLeft = minutes * 60;
                updateDisplay();
            }
        }
        updateDisplay();
    </script>
</body>

</html>